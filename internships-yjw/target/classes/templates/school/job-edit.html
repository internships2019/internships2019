<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>班级修改</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" th:href="@{/css/font.css}" href="./css/font.css">
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" href="./css/xadmin.css">
    <script th:src="@{/layui/layui.js}" src="layui/layui.js" charset="utf-8"></script>
</head>
<body style="margin: 20px">
    <form class="layui-form layui-form-pane" lay-filter="frm">
        <input type="hidden" name="jobId">
        <div class="layui-form-item">
            <label class="layui-form-label">岗位名称：</label>
            <div class="layui-input-inline">
                <input type="tel" name="jobName" lay-verify="required" placeholder="请输入岗位名称" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">工作地点：</label>
            <div class="layui-input-block">
                <input type="text" name="workPlace" placeholder="请输入工作地点" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">招收人数：</label>
            <div class="layui-input-inline">
                <input type="text" name="recruitNum" placeholder="请输入招收人数" lay-verify="required|INT" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">截止时间：</label>
            <div class="layui-inline">
                <input type="text" name="endTime" id="endTime" lay-verify="required" class="layui-input test-item" placeholder="yyyy-MM-dd HH:mm:ss">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">岗位状态：</label>
            <div class="layui-input-inline">
                <select name="adState"lay-verify="required" lay-search="" lay-filter="comName">
                    <option value=""></option>
                    <option value="可申请" id="endApply">可申请</option>
                    <option value="截止申请" id="endApply2">截止申请</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label" >岗位简述：</label>
            <div class="layui-input-block">
                <textarea placeholder="请输入内容" maxlength="200" lay-verify="required" name="workDescription" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <button class="layui-btn" lay-submit="" lay-filter="demo">修改</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </form>
    <script>
        function child(d) {
            layui.use(['form','layer','jquery','laydate','util'],function () {
                var form=layui.form;
                var layer=layui.layer;
                var $=layui.jquery;
                var laydate=layui.laydate;
                var util=layui.util;

                //初始化日期时间选择器
                laydate.render({
                    elem:'#endTime'
                    ,type: 'datetime'
                    ,isInitValue: true
                    ,value: util.toDateString(d.endTime, 'yyyy-MM-dd HH:mm:ss')
                });

                //根据实习岗位状态设置下拉框属性
                if (d.adState == '截止申请'){
                    $('#endApply2').attr('selected',true);
                }else {
                    $('#endApply').attr('selected',true);
                }
                form.render('select');

                //将行数据赋值到弹窗表单中
                form.val("frm",{
                    "jobId":d.jobId,
                    "jobName":d.jobName,
                    "workPlace":d.workPlace,
                    "recruitNum":d.recruitNum,
                    "workDescription":d.workDescription
                });

                //表单提交修改学校
                form.on('submit(demo)',function (fdata) {
                    if (fdata.field.recruitNum<=d.recruitNum&&fdata.field.adState=='可申请'){
                        layer.msg('招收人数已满，无法设置岗位为可申请状态!',{icon:5});
                    }else{
                        $.ajax({
                            url:'/internships/companyJob/edit_company_job'
                            ,type:'post'
                            ,contentType: 'application/json'
                            ,dataType:'text'
                            ,data:JSON.stringify(fdata.field)
                            ,success:function () {
                                parent.callData=fdata.field;
                                layer.alert("实习岗位修改成功！",{icon:1},function () {
                                    var index = parent.layer.getFrameIndex(window.name);//关闭当前弹出层
                                    parent.layer.close(index);//执行弹出层关闭
                                });
                            }
                        });
                    }
                    return false;
                });


                //手机号与座机号验证规则
                var mobile = /^1[3|4|5|7|8]\d{9}$/,phone = /^0\d{2,3}-?\d{7,8}$/;
                form.verify({
                    INT: [
                        /^[+]{0,1}(\d+)$/ //正则表达式
                        ,'招收人数只能为正整数' //提示信息
                    ],
                    tellphone: function(value){
                        var flag = mobile.test(value) || phone.test(value);
                        if(!flag){
                            return '请输入正确座机号码或手机号';
                        }
                    }
                });
            });
        }
    </script>
</body>
</html>